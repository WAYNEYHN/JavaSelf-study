#### JAVA的中的String类为什么不可变

不可变对象的优势：

1. 不可变对象可以提高String Pool的效率和安全性，如果你知道一个对象时不可变动的，那么需要拷贝的对象的内容时，就不用复制他本身而只是复制他的地址，复制地址（通常一个指针的大小）需要很小的内存，效率也很好。而对于其它引用统一的对象的其他变量也不会造成影响
2. 不可变对象对于多线程全，可以防止对象的值被其他的线程改变，造成不可预期的结果



1. #### 字符串常量池的需要

   - 字符串常量池时JAVA堆内存中一个特殊的存储区域，当创建一个String对象时，假如此字符串值已存在于常量池中，则不会创建一个新的对象，而是引用已经存在的对象

     ```java
     String s1 = "ABC";
     String S2 = "ABC"
     ```

     

   - 在Java中内存分为堆内存和栈内存，堆内存存放的时对象，栈内存存储对象的引用，字符串‘ABC’存放在堆内存中，而s1,s2作为对象的引用则存放在栈内存中

2. #### 运行String对象缓存HashCode

   - Java中String对象的哈希码被频繁使用，比如在HashMap容器中。

   - 字符串不变性保证了hash码的唯一性，因此可以放心的进行缓存，这也是一种性能优化的有段，意味着不必每次都去计算性的hash码，在String类的定义中又如下代码：

     ```java
     private int hash;//用来缓存HashCode
     ```

     

3. #### 安全性

   1. String被许多Java类（库）用来当作参数，还有反射机制所需要的Stirng参数等，假若String类不是固定不变的，将会有很多安全隐患。

   ### 主要是为了效率和安全

#### 一、String类不可变性的具体好处



1.只有当字符串是不可变的，字符串池才有可能实现。字符串池的实现可以在运行时节约很多heap空间，因为不同的字符串变量都指向池中的同一个字 符串。但如果字符串是可变的，



那么String interning将不能实现(译者注：String interning是指对不同的字符串仅仅只保存一个，即不会保存多个相同的字符串。)，因为这样的话，如果变量改变了它的值，那么



其它指向这个值的变量 的值也会一起改变。



2.如果字符串是可变的，那么会引起很严重的安全问题。譬如，数据库的用户名、密码都是以字符串的形式传入来获得数据库的连 接，或者在socket编程中，主机名和端口都是以字



符串的形式传入。因为字符串是不可变的，所以它的值是不可改变的，否则黑客们可以钻到空子，改变字符 串指向的对象的值，造成安全漏洞。



3.因为字符串是不可变的，所以是多线程安全的，同一个字符串实例可以被多个线程共享。这样便不用因为线程安全问题而使用同步。字符串自己便是线程安全的。



4.类加载器要用到字符串，不可变性提供了安全性，以便正确的类被加载。譬如你想加载java.sql.Connection类，而这个值被改成了myhacked.Connection，那么会对你的数据库造成



不可知的破坏。



5.因为字符串是不可变的，所以在它创建的时候hashcode就被缓存了，不需要重新计算。这就使得字符串很适合作为Map中的键，字符串的处理速度要快过其它的键对象。这就是HashMap



中的键往往都使用字符串。





二、既然知道String类型不可变的好处和作用那么大，那么是否就不需要可变类型了呢？



当然不是，当你需要向字符串插入或修改的时候，Sting不可变类型就显得足襟见肘，这时候就需要一个可变的字符串类型：StringBuffer。



StringBuffer与String一样，都代表字符串，但是由于StringBuffer内部实现的方式和String不同，所以StringBuffer在处理字符串的时候



不产生新的对象，在内存使用上要由于String类。



 